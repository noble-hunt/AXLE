Clean up server TypeScript errors for Vercel

We’re deploying the AXLE repo to Vercel. The server build now runs tsc -p tsconfig.server.json before npm run build. TypeScript is currently reporting these errors:

server/ai/generators/test.ts(14,24): error TS2307: Cannot find module '../../../src/ai/render'
server/ai/generators/test.ts(27,7): error TS2322: Type '"CrossFit/HIIT"' is not assignable to type 'Category'.
server/ai/generators/test.ts(103,7): error TS2322: Type '"Olympic"' is not assignable to type 'Category'.
server/dal/groupAchievements.ts(153,9): error TS2353: Object literal may only specify known properties, and 'progress' does not exist in type 'PgUpdateSetSource<...group_achievements...>'.
server/dal/groups.ts(64,6): error TS2769: No overload matches this call.


Goal: Make npx tsc -p tsconfig.server.json pass with zero errors for production server code, while keeping prod behavior correct. Test harness files should not be part of the server build.

1) Exclude server/ai/generators/test.ts from the production server build

Open server/ai/generators/test.ts.

Confirm this file is a test/dev harness and is not imported by the actual server entrypoints (e.g., server/index.ts, route handlers, or DAL files). Use “Find references” to double-check.

If it is only used for testing:

Update tsconfig.server.json so that the include / exclude config does not compile this file. For example:

{
  "extends": "./tsconfig.json",
  "compilerOptions": {
    "outDir": ".",
    "noEmit": false
  },
  "include": [
    "server/**/*.ts"
  ],
  "exclude": [
    "server/ai/generators/test.ts",
    "**/*.test.ts",
    "node_modules",
    "dist",
    ".vercel"
  ]
}


Alternatively, you can move the file into a tests/ directory that is not included by tsconfig.server.json.

After this change, run:

npx tsc -p tsconfig.server.json


and confirm there are no errors referencing server/ai/generators/test.ts.

Do not try to force the server build to pull in src/ai/render just for this test file. The right fix is to treat it as test-only and keep it out of the prod server build.

2) Fix server/dal/groupAchievements.ts to match the Drizzle schema

Open the Drizzle schema definition for the group_achievements table (wherever it lives, e.g. server/db/schema/groupAchievements.ts or similar).

List the actual column names and types for this table.

Open server/dal/groupAchievements.ts and go to the line that produces the error (around line 153). It’s likely an update like:

await db.update(groupAchievements)
  .set({ progress: ..., /* other fields */ })
  .where(...);


Align this DAL code with the schema:

If the schema really has a progress column that is missing from the TypeScript definition, then:

Add progress to the Drizzle table definition with the correct type, and generate/align with the existing migrations if necessary.

If the progress column was removed or renamed in the schema:

Remove or rename the progress field in the .set({ ... }) call to use the correct existing column(s).

The goal is: the object passed to .set() only contains keys that exist on the Drizzle table type, so TS2353 goes away and the update matches what the database actually expects.

Re-run:

npx tsc -p tsconfig.server.json


and verify that the groupAchievements.ts error is gone.

3) Fix the Drizzle call in server/dal/groups.ts

Open server/dal/groups.ts and go to line 64 where TS2769 is raised.

Look at the exact call that fails, and the full TypeScript error text (it usually shows the expected overloads).

Compare the call’s arguments to the Drizzle types for the groups table:

Check the table definition for groups (similar to how you did for group_achievements).

Make sure we are not passing extra fields, wrong shapes, or missing required fields.

Update the code so that the call matches one of the Drizzle overloads:

For example, if it’s an update call, ensure .set({ ... }) uses only valid columns.

If it’s db.insert(groups).values(...), make sure the object matches the Insert type for the table (you can use typeof groups.$inferInsert if needed).

Once updated, run:

npx tsc -p tsconfig.server.json


and confirm there are no remaining errors in server/dal/groups.ts.

4) Final sanity check

After all fixes, run:

npx tsc -p tsconfig.server.json


and ensure zero errors.

Confirm the following files exist and are in the right places for Vercel:

api/index.ts (no compiled api/index.js tracked in git),

server/app.ts (or main Express app file),

server/app.js compiled by tsconfig.server.json.

Make sure api/index.ts still imports the app using a path that matches the compiled JS location, for example:

import app from '../server/app.js';
export default app;


Commit the changes and push to main so Vercel redeploys.

In your final message, summarize:

What you did with server/ai/generators/test.ts (how it was excluded from the server build),

How the group_achievements schema and DAL were synced,

What the fix was in server/dal/groups.ts,

And confirm that npx tsc -p tsconfig.server.json now passes with no errors.