Confirm the route & import wiring (one source of truth)

Goal: Make sure both /api/workouts/preview and /api/workouts/generate import the same orchestrator and expose a debug stamp.

Edit server/workoutGenerator.ts (or your actual orchestrator file):

// server/workoutGenerator.ts
import { DISABLE_SIMPLE, DISABLE_MOCK, FORCE_PREMIUM } from './config/env';

// Add a visible stamp so we can confirm this file is the one running
export const GENERATOR_STAMP = 'WG-ORCH@1.0.0';

export async function generateWorkout(req: any) {
  console.warn('[WG] start', { stamp: GENERATOR_STAMP, style: req.goal, minutes: req.durationMin });

  try {
    const res = await premiumPath(req);
    console.warn('[WG] premium ok', { stamp: GENERATOR_STAMP });
    return res;
  } catch (e: any) {
    console.error('[WG] premium_failed', { stamp: GENERATOR_STAMP, err: String(e?.message || e) });

    if (DISABLE_SIMPLE || DISABLE_MOCK || FORCE_PREMIUM) {
      // HARD STOP WHILE TESTING
      e.message = `premium_failed:${e.message}`;
      throw e;
    }
  }

  if (!DISABLE_SIMPLE) {
    try {
      const s = await simplePath(req);
      console.warn('[WG] simple ok', { stamp: GENERATOR_STAMP });
      return s;
    } catch (e) {
      console.error('[WG] simple_failed', { stamp: GENERATOR_STAMP, err: String(e?.message || e) });
    }
  }

  if (!DISABLE_MOCK) {
    console.warn('[WG] mock_fallback', { stamp: GENERATOR_STAMP });
    return await mockPath(req);
  }

  throw new Error('no_generator_available');
}


Edit server/routes/workout-generate.ts and server/routes/workout-simulate.ts to ensure both use the same orchestrator:

// server/routes/workout-generate.ts
import { GENERATOR_STAMP, generateWorkout } from '../workoutGenerator';

router.post('/api/workouts/generate', async (req, res, next) => {
  try {
    const workout = await generateWorkout(req.body);
    res.setHeader('X-AXLE-Generator', workout?.meta?.generator || 'unknown');
    res.setHeader('X-AXLE-Style', workout?.meta?.style || req.body?.goal || 'unknown');
    res.setHeader('X-AXLE-Orchestrator', GENERATOR_STAMP);
    return res.json({ ok: true, workout });
  } catch (e) {
    next(e);
  }
});


Do the same header stamp for /api/workouts/preview.